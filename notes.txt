need to fix leaks from strjoin presumably and fix wide strings
